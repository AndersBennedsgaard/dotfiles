---
- name: Check if ~/.oh-my-zsh/ exist
  stat:
    path: ~/.oh-my-zsh/
  register: ohmyzsh_installed
  become_user: "{{ user_name }}"
  become: true

- name: Get oh-my-zsh
  get_url:
    url: "https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh"
    dest: "/tmp/ohmyzsh-install.sh"
    mode: 0755
  become_user: "{{ user_name }}"
  when: not ohmyzsh_installed.stat.exists
  become: true

- name: Run installation
  shell: /tmp/ohmyzsh-install.sh
  when: not ohmyzsh_installed.stat.exists
  become_user: "{{ user_name }}"
  become: true

- name: Ensure ~/.oh-my-zsh/ exist
  stat:
    path: ~/.oh-my-zsh/
  register: file
  become_user: "{{ user_name }}"
  become: true

- name: Fail if file does not exist
  fail:
    msg: "~/.oh-my-zsh/ does not exist"
  when: "not file.stat.exists"
  become_user: "{{ user_name }}"
  become: true
